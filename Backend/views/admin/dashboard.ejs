<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-100">
    <%- include('../partials/header') %>
    
    <!-- Page Header -->
    <div class="gradient-bg text-white py-6 px-6">
        <div class="max-w-7xl mx-auto text-center">
            <i class="fas fa-user-shield text-4xl mb-2"></i>
            <h1 class="text-4xl font-bold">Admin Dashboard</h1>
            <p class="text-xl opacity-90 mt-2">Manage classes, users, and platform content</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 rounded-full">
                        <i class="fas fa-users text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Total Users</p>
                        <p class="text-2xl font-bold"><%= totalUsers %></p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="p-3 bg-green-100 rounded-full">
                        <i class="fas fa-dumbbell text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Total Classes</p>
                        <p class="text-2xl font-bold"><%= totalClasses %></p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="p-3 bg-orange-100 rounded-full">
                        <i class="fas fa-video text-orange-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Live Classes</p>
                        <p class="text-2xl font-bold"><%= classes.filter(c => c.type === 'paid' && c.isActive).length %></p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 rounded-full">
                        <i class="fas fa-gift text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Free Classes</p>
                        <p class="text-2xl font-bold"><%= classes.filter(c => c.type === 'free').length %></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Management -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-dumbbell mr-3 text-red-500"></i>
                    Class Management
                </h2>
                <button onclick="toggleClassForm()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300 flex items-center space-x-2">
                    <i class="fas fa-plus"></i>
                    <span>Create Class</span>
                </button>
            </div>

            <!-- Create Class Form -->
            <div id="classForm" class="hidden bg-gray-50 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">Create New Class</h3>
                <form action="/admin/class/create" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="title" placeholder="Class Title" required class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <select name="type" required class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500" onchange="togglePriceField(this)">
                        <option value="">Select Type</option>
                        <option value="free">Free</option>
                        <option value="paid">Paid</option>
                    </select>
                    <input type="number" name="price" id="priceField" placeholder="Price" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500 hidden">
                    <input type="number" name="duration" placeholder="Duration (minutes)" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <input type="number" name="maxParticipants" placeholder="Max Participants" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <input type="datetime-local" name="scheduledDate" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <textarea name="description" placeholder="Class Description" class="md:col-span-2 border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500" rows="3"></textarea>
                    <input type="url" name="videoUrl" placeholder="Video URL (for recorded classes)" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <input type="url" name="meetingLink" placeholder="Meeting Link (for live classes)" class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                    <select name="category" required class="border rounded-lg px-4 py-2 focus:ring-2 focus:ring-red-500">
                        <option value="">Select Service Category</option>
                        <option value="yoga">Yoga</option>
                        <option value="zumba">Zumba</option>
                        <option value="pranayam">Pranayam</option>
                        <option value="meditation">Meditation</option>
                        <option value="fitness">Fitness</option>
                        <option value="pilates">Pilates</option>
                        <option value="aerobics">Aerobics</option>
                    </select>
                    <div class="md:col-span-2 flex space-x-4">
                        <button type="submit" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition duration-300">Create Class</button>
                        <button type="button" onclick="toggleClassForm()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition duration-300">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Classes List -->
            <div class="space-y-4">
                <% if (classes && classes.length > 0) { %>
                    <% classes.forEach(classItem => { %>
                        <div class="border border-gray-200 rounded-lg p-4 card-hover">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <h3 class="text-lg font-semibold"><%= classItem.title %></h3>
                                        <span class="px-2 py-1 rounded-full text-xs font-medium <%= classItem.type === 'free' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800' %>">
                                            <%= classItem.type.toUpperCase() %>
                                        </span>
                                        <% if (classItem.type === 'paid') { %>
                                            <span class="text-green-600 font-semibold">$<%= classItem.price %></span>
                                        <% } %>
                                    </div>
                                    <p class="text-gray-600 mb-2"><%= classItem.description %></p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-clock mr-1"></i><%= classItem.duration %> min</span>
                                        <span><i class="fas fa-users mr-1"></i><%= classItem.participants ? classItem.participants.length : 0 %>/<%= classItem.maxParticipants %></span>
                                        <% if (classItem.scheduledDate) { %>
                                            <span><i class="fas fa-calendar mr-1"></i><%= new Date(classItem.scheduledDate).toLocaleDateString() %></span>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <% if (classItem.type === 'paid') { %>
                                        <a href="/admin/class/<%= classItem._id %>/chat" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition duration-300">
                                            <i class="fas fa-comments mr-1"></i>Chat
                                        </a>
                                    <% } %>
                                    <button onclick="editClass('<%= classItem._id %>')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-300">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <form action="/admin/class/delete/<%= classItem._id %>" method="POST" class="inline" onsubmit="return confirm('Delete this class?')">
                                        <button type="submit" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition duration-300">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="text-center py-8">
                        <i class="fas fa-dumbbell text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">No classes created yet.</p>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Recent Users -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-users mr-3 text-red-500"></i>
                Recent Users
            </h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-3">User</th>
                            <th class="text-left py-3">Email</th>
                            <th class="text-left py-3">Membership</th>
                            <th class="text-left py-3">Joined</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (users && users.length > 0) { %>
                            <% users.slice(0, 10).forEach(user => { %>
                                <tr class="border-b hover:bg-gray-50">
                                    <td class="py-3">
                                        <div class="flex items-center space-x-3">
                                            <img src="<%= user.profilePhoto || '/images/default-avatar.png' %>" alt="Avatar" class="w-8 h-8 rounded-full">
                                            <span><%= user.firstName %> <%= user.lastName %></span>
                                        </div>
                                    </td>
                                    <td class="py-3"><%= user.email %></td>
                                    <td class="py-3">
                                        <span class="px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800">
                                            <%= user.membershipType %>
                                        </span>
                                    </td>
                                    <td class="py-3"><%= new Date(user.createdAt).toLocaleDateString() %></td>
                                </tr>
                            <% }) %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function toggleClassForm() {
            const form = document.getElementById('classForm');
            form.classList.toggle('hidden');
        }

        function togglePriceField(select) {
            const priceField = document.getElementById('priceField');
            if (select.value === 'paid') {
                priceField.classList.remove('hidden');
                priceField.required = true;
            } else {
                priceField.classList.add('hidden');
                priceField.required = false;
                priceField.value = '';
            }
        }

        function editClass(classId) {
            // Simple edit functionality - you can enhance this
            window.location.href = '/admin/class/edit/' + classId;
        }
    </script>
</body>
</html>